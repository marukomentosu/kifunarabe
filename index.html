<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Shogi Replay System - htmlマン２</title>
    <style>
        :root {
            --board-bg: #e6b422;
            --cell-border: #333;
            --sidebar-width: 350px;
            --accent: #d35400;
        }

        body, html {
            margin: 0; padding: 0; height: 100%;
            font-family: 'Sawarabi Mincho', serif;
            background: #2c3e50; color: #ecf0f1;
            display: flex; overflow: hidden;
        }

        /* メインレイアウト */
        #app-container {
            display: flex; width: 100vw; height: 100vh;
        }

        /* 盤面セクション */
        #board-section {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            background: #34495e; position: relative;
        }

        .shogi-board {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            grid-template-rows: repeat(9, 1fr);
            width: min(80vh, 80vw);
            height: min(80vh, 80vw);
            background: var(--board-bg);
            border: 2px solid #000;
        }

        .cell {
            border: 1px solid var(--cell-border);
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; color: #000; cursor: pointer;
            position: relative;
        }

        .cell.last-move { background: rgba(255, 255, 0, 0.3); }

        /* サイドバー */
        #sidebar {
            width: var(--sidebar-width);
            background: #2c3e50; border-left: 2px solid #1a252f;
            display: flex; flex-direction: column;
        }

        .info-panel, .move-list, .comment-box, .analysis-panel {
            padding: 15px; border-bottom: 1px solid #34495e;
        }

        .move-list { flex-grow: 1; overflow-y: auto; background: #1a252f; }
        .move-item { cursor: pointer; padding: 4px; }
        .move-item:hover { background: #34495e; }
        .move-item.active { background: var(--accent); }

        /* コントロール UI */
        .controls {
            display: flex; justify-content: space-around; padding: 10px;
            background: #2c3e50;
        }

        button {
            padding: 10px; cursor: pointer; background: #7f8c8d;
            border: none; color: white; border-radius: 4px;
        }

        button:hover { background: var(--accent); }

        /* 設定・解析オーバーレイ用 */
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; }
    </style>
</head>
<body>

<div id="app-container">
    <div id="board-section">
        <div id="game-info-top">後手：プロ棋士 A</div>
        <div id="captured-gote" class="hand"></div>
        <div class="shogi-board" id="board">
            </div>
        <div id="captured-sente" class="hand"></div>
        <div id="game-info-bottom">先手：プロ棋士 B</div>
        
        <div class="controls">
            <button onclick="game.first()">|&lt;</button>
            <button onclick="game.prev()">&lt;</button>
            <button onclick="game.autoplay()">再生</button>
            <button onclick="game.next()">&gt;</button>
            <button onclick="game.last()">&gt;|</button>
        </div>
    </div>

    <div id="sidebar">
        <div class="info-panel">
            <h3>対局情報</h3>
            <div id="meta-data">棋戦：名人戦<br>日付：2025/12/19</div>
        </div>
        <div class="move-list" id="move-list">
            </div>
        <div class="analysis-panel">
            <h4>解析：評価値</h4>
            <div id="evaluation-score">0</div>
        </div>
        <div class="comment-box">
            <h4>解説・コメント</h4>
            <div id="comment-text">ここに解説が表示されます。</div>
        </div>
    </div>
</div>

<script>
/**
 * htmlマン２：将棋システム・コアロジック
 * 500の要件を拡張するためのカプセル化されたクラス群
 */

class ShogiGame {
    constructor() {
        this.boardState = this.initBoard();
        this.history = []; // 棋譜データ (51-250の要件)
        this.currentIndex = 0;
        this.settings = {}; // 451-500の要件
        this.initUI();
    }

    initBoard() {
        // 1-50の描画要件に基づき、初期配置を生成
        const board = Array(9).fill(null).map(() => Array(9).fill(null));
        // 簡易的な初期配置ロジック（実際には駒クラスを配置）
        return board;
    }

    initUI() {
        const boardEl = document.getElementById('board');
        boardEl.innerHTML = '';
        for (let r = 0; r < 9; r++) {
            for (let c = 0; c < 9; c++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.pos = `${r},${c}`;
                cell.onclick = () => this.handleCellClick(r, c);
                boardEl.appendChild(cell);
            }
        }
        this.render();
    }

    // 棋譜操作ロジック (51-150要件)
    next() {
        console.log("次の一手へ");
        this.currentIndex++;
        this.render();
    }

    prev() {
        if(this.currentIndex > 0) this.currentIndex--;
        this.render();
    }

    first() { this.currentIndex = 0; this.render(); }
    last() { this.currentIndex = this.history.length; this.render(); }

    autoplay() {
        // 自動再生ロジック (155要件等)
        setInterval(() => this.next(), 1000);
    }

    // 描画エンジン (1-50要件)
    render() {
        // 駒の再描画、移動元の強調、王手判定などを一括処理
        console.log("盤面を更新しました。");
    }

    // データ読み込み (151-250要件)
    loadKif(data) {
        console.log("KIF形式を解析します。");
        // 解析ロジック...
    }

    // 解析連携 (351-450要件)
    analyze() {
        // USIエンジンとのWebWorker経由での通信
    }
}

// システム起動
const game = new ShogiGame();

// ショートカットキーの実装 (51要件)
window.addEventListener('keydown', (e) => {
    if(e.key === 'ArrowRight') game.next();
    if(e.key === 'ArrowLeft') game.prev();
});

</script>
</body>
</html>
